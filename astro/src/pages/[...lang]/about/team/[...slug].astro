---
import Base from "@/layouts/Base.astro";
import dateFormat from "@/lib/utils/dateFormat";
import { markdownify } from "@/lib/utils/textConverter";
import { getCollectionCTM } from "@/lib/contentParser.astro";
import CallToAction from "@/components/sections/CallToAction.astro";
import config from ".astro/config.generated.json" assert { type: "json" };
import { supportedLanguages } from "@/lib/utils/i18nUtils.ts";

// get static paths for all team members
export async function getStaticPaths() {
  const paths = await Promise.all(
    supportedLanguages.map(async (lang) => {
      const { defaultLanguage, showDefaultLangInUrl } =
        config.settings.multilingual;

      let teamMembers = await getCollectionCTM("team-members", lang.languageCode);

      return teamMembers.map((member) => ({
        params: {
          lang:
            lang.languageCode === defaultLanguage && !showDefaultLangInUrl
              ? undefined
              : lang.languageCode,
          slug: member.id
            .replace(/\.mdx?|\.md/g, "")
            .split("/")
            .pop(),
        },
        props: {
          member,
        },
      }));
    }),
  );

  return paths.flat();
}

const { member } = Astro.props;
const { title, date } = member.data;
const { Content } = await member.render();
---

<Base {...member.data}>
  <section class="py-12">
    <div class="container">
      <div class="mx-auto max-w-5xl">
        <div class="mb-8 text-center">
          <h1 class="text-h2 mb-4" set:html={markdownify(title)} />
        </div>
        <div class="prose prose-lg mx-auto max-w-none">
          <Content />
        </div>
      </div>
    </div>
  </section>
  <CallToAction />
</Base>