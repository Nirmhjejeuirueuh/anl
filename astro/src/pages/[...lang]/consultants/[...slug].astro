---
import Base from "@/layouts/Base.astro";
import CallToAction from "@/components/sections/CallToAction.astro";
import { getConsultantBySlug, STRAPI_URL } from "@/lib/utils/strapiApi";
import { generatePaths } from "@/lib/utils/i18nUtils.ts";
import { markdownify } from "@/lib/utils/textConverter";

// Enable SSR for dynamic Strapi content
export const prerender = false;

const { slug } = Astro.params as any;

// Fetch consultant by slug
const consultant = await getConsultantBySlug(slug);

if (!consultant) {
  throw new Error(`Consultant with slug "${slug}" not found`);
}

// Mock page data
const pageData = {
  title: consultant.title,
  metaDescription: consultant.description,
  draft: false
};
---

<Base title={pageData.title} metaDescription={pageData.metaDescription} draft={pageData.draft}>

  <!-- Consultant Hero Section -->
  <section class="py-12">
    <div class="container">
      <div class="grid grid-cols-1 justify-items-center space-y-12">
        <!-- Consultant Meta -->
        <div class="max-w-full space-y-8 text-center lg:max-w-3xl">
          <div>
            <h1 class="text-h3 md:text-h2">{consultant.title}</h1>
            {consultant.description && (
              <p class="text-muted mt-6">{consultant.description}</p>
            )}
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- Consultant Content Section -->
  {consultant.content && (
    <section class="py-16 md:py-20 lg:py-24">
      <div class="container">
        <div class="mx-auto max-w-4xl">
          <div class="prose prose-lg prose-gray max-w-none">
            <div set:html={markdownify(consultant.content, true)}></div>
          </div>
        </div>
      </div>
    </section>
  )}

  <CallToAction />
</Base>