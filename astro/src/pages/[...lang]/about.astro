---
import Base from "@/layouts/Base.astro";
import { getEntryCTM } from "@/lib/contentParser.astro";
import handleDraftPage from "@/lib/utils/handleDraftPage";
import AboutBanner from "@/layouts/components/sections/AboutBanner.astro";
import CompanySection from "@/layouts/components/sections/CompanySection.astro";
import OurTeam from "@/components/sections/OurTeam.astro";
import CallToAction from "@/components/sections/CallToAction.astro";
import { generatePaths } from "@/lib/utils/i18nUtils.ts";
import { STRAPI_URL } from "@/lib/strapiApi";

export function getStaticPaths() {
  return generatePaths();
}

export const prerender = false;

// Fetch about page from Strapi
const response = await fetch(`${STRAPI_URL}/api/about-page?populate=*`);
if (!response.ok) {
  throw new Error(`Failed to fetch about page: ${response.status}`);
}
const strapiData = await response.json();
const entry = { data: strapiData.data };

// Remove drafts pages in production (adapt for Strapi)
const draftResponse = handleDraftPage(entry?.data);
if (draftResponse) return draftResponse;
---

<Base {...entry?.data}>
  <AboutBanner images={entry?.data?.images} />
  <CompanySection mission={entry?.data?.mission} vision={entry?.data?.vision} values={entry?.data?.core_values} />
  <OurTeam />
  <CallToAction />
</Base>
