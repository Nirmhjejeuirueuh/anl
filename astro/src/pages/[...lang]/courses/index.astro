---
import Base from "@/layouts/Base.astro";
import { getEntryCTM } from "@/lib/contentParser.astro";
import handleDraftPage from "@/lib/utils/handleDraftPage";
import CallToAction from "@/components/sections/CallToAction.astro";
import CoursesSection from "@/layouts/components/sections/CoursesSection.astro";
import CourseFilters from "@/layouts/components/widgets/CourseFilters.astro";
import config from ".astro/config.generated.json" assert { type: "json" };
import { generatePaths } from "@/lib/utils/i18nUtils.ts";
import { getCollectionCTM } from "@/lib/contentParser.astro";

export function getStaticPaths() {
  return generatePaths();
}

const entry = await getEntryCTM(
  "courses",
  "-index",
  Astro.currentLocale,
);

if (!entry || !entry.data) {
  return Astro.redirect("/404");
}

// Remove drafts pages in production
const response = handleDraftPage(entry.data);
if (response) return response;

const {
  title,
  metaDescription,
  draft,
  hasCustomLineAnimationBg,
  ...rest
} = entry.data;

// Get courses for filters
const courses = await getCollectionCTM(
  config.settings.coursesFolder as "courses",
  Astro.currentLocale,
);
---

<Base
  title={title}
  metaDescription={metaDescription}
  draft={draft}
  sectionSpacing="none"
  className={hasCustomLineAnimationBg ? "has-custom-line-animation-bg" : ""}
>
  <!-- Course Filters Section -->
<section class="pt-4 pb-8 bg-theme-light">
  <div class="container">
    <!-- Courses Title -->
    <div class="text-center mb-4">
      <span class="mb-2.5 inline-block rounded-full border px-5 py-px bg-primary/5 border-secondary text-primary">
        Our Courses
      </span>
      <h2 class="text-h3 text-dark">
        Advance Your Career with Expert-Led Training
      </h2>
    </div>
    <CourseFilters courses={courses} />
  </div>
</section>

  <CoursesSection content={entry.data.indexCoursesSection} />
  <CallToAction />
</Base>
