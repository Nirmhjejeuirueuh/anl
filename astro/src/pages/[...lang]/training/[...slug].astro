---
import Base from "@/layouts/Base.astro";
import CallToAction from "@/components/sections/CallToAction.astro";
import PageHeader from "@/layouts/components/widgets/PageHeader.astro";
import { getTrainingBySlug } from "@/lib/utils/strapiApi";
import { generatePaths } from "@/lib/utils/i18nUtils.ts";
import { markdownify } from "@/lib/utils/textConverter";

// Enable SSR for dynamic Strapi content
export const prerender = false;

const { slug } = Astro.params as any;

// Fetch training by slug
const training = await getTrainingBySlug(slug);

if (!training) {
  throw new Error(`Training with slug "${slug}" not found`);
}
---

<Base title={training.seoTitle || training.title} metaDescription={training.seoDescription}>
  <PageHeader title={training.title} subtitle={training.description} />

  <!-- Training Content Section -->
  <section class="relative py-16 md:py-20 lg:py-24 -mt-16">
    <div class="container">
      <div class="mx-auto max-w-4xl">
        <div class="space-y-8 md:space-y-12">
          <!-- Training Type Badge -->
          {training.trainingType && (
            <div data-aos="fade-up-sm" class="flex justify-center">
              <span class="inline-flex items-center px-4 py-2 rounded-full text-sm font-medium bg-primary/10 text-primary border border-primary/20">
                {training.trainingType.replace('_', ' ').replace(/\b\w/g, l => l.toUpperCase())}
              </span>
            </div>
          )}

          <!-- Training Content -->
          <div
            data-aos="fade-up-sm"
            class="prose prose-lg prose-gray max-w-none text-justify">
            {training.content && (
              <div set:html={markdownify(training.content, true)}></div>
            )}
          </div>

          <!-- Training Images -->
          {training.images && training.images.length > 0 && (
            <div data-aos="fade-up-sm" class="grid gap-6 md:grid-cols-2 lg:grid-cols-3">
              {training.images.map((image: any, index: number) => (
                <div class="aspect-[16/9] overflow-hidden rounded-xl shadow-lg">
                  <img
                    src={image.url}
                    alt={image.alternativeText || training.title}
                    class="w-full h-full object-cover hover:scale-105 transition-transform duration-300"
                  />
                </div>
              ))}
            </div>
          )}

          <!-- Categories and Tags -->
          {(training.categories || training.tags) && (
            <div data-aos="fade-up-sm" class="flex flex-wrap gap-2 pt-8 border-t border-gray-200">
              {training.categories && training.categories.map((category: any) => (
                <span class="inline-flex items-center px-3 py-1 rounded-full text-sm bg-gray-100 text-gray-700">
                  {category.name}
                </span>
              ))}
              {training.tags && training.tags.map((tag: any) => (
                <span class="inline-flex items-center px-3 py-1 rounded-full text-sm bg-blue-100 text-blue-700">
                  #{tag.name}
                </span>
              ))}
            </div>
          )}
        </div>
      </div>
    </div>
  </section>

  <CallToAction />
</Base>