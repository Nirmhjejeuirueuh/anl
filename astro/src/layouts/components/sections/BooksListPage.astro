---
// Books List Page Component
// Displays a grid of book cards with data from Strapi CMS

import CustomButton from "@/components/CustomButton.astro";
import { getBooks } from "@/lib/utils/strapiApi";
import { STRAPI_URL } from "@/lib/strapiApi";
import { markdownify } from "@/lib/utils/textConverter";

// Fetch books from Strapi CMS
const books = await getBooks();
---

{books && books.length > 0 ? (
  <section class="py-16 md:py-20 lg:py-24 bg-gray-50">
    <div class="container">
      <div class="grid gap-12 md:grid-cols-1 lg:grid-cols-1">
        {books.map((book) => (
          <div class="group bg-white rounded-2xl shadow-sm hover:shadow-xl transition-all duration-300 overflow-hidden">
            <div class="flex flex-col md:flex-row">
              <!-- Book Image - Left Side -->
              <div class="md:w-2/5 lg:w-1/3 flex items-center justify-center px-8 py-8">
                <div class="relative">
                  <!-- 3D Book Shadow Effect -->
                  <div class="absolute inset-0 bg-gray-900/20 rounded-lg transform translate-x-2 translate-y-2 -z-10"></div>
                  <div class="absolute inset-0 bg-gray-900/10 rounded-lg transform translate-x-1 translate-y-1 -z-10"></div>

                  <!-- Book Image Container -->
                  <div class="w-full max-w-sm overflow-hidden rounded-lg shadow-2xl transform transition-all duration-300 group-hover:scale-105 group-hover:-translate-y-1">
                    <img
                      src={book.image ? (book.image.url.startsWith('http') ? book.image.url : `${STRAPI_URL}${book.image.url}`) : "/images/placeholder-book.jpg"}
                      alt={book.title}
                      class="w-full h-auto object-contain"
                    />

                    <!-- Book Spine Effect -->
                    <div class="absolute top-0 left-0 w-1 bg-gradient-to-r from-gray-800 to-transparent opacity-30"></div>
                  </div>
                </div>
              </div>

              <!-- Book Content - Right Side -->
              <div class="md:w-3/5 lg:w-2/3 p-8 flex flex-col justify-center pl-12">
                <div class="space-y-6">
                  <h3 class="text-3xl lg:text-4xl font-bold text-gray-900 leading-normal">
                    {book.title}
                  </h3>

                  <div class="flex items-center space-x-4 text-base text-gray-600 leading-relaxed pb-4">
                    <span class="font-medium">By {book.author}</span>
                    <span>•</span>
                    <span>{book.pages} pages</span>
                    <span>•</span>
                    <span>{book.publishedDate}</span>
                  </div>

                  <div class="text-gray-700 text-lg leading-relaxed max-w-2xl pb-4 prose prose-lg" set:html={markdownify(book.description)}></div>

                  <div class="pt-4">
                    <CustomButton
                      size="md"
                      variant="fill"
                      label={book.buttonText}
                      url={book.buttonLink}
                    />
                  </div>
                </div>
              </div>
            </div>
          </div>
        ))}
      </div>
    </div>
  </section>
) : (
  <section class="py-16 md:py-20 lg:py-24 bg-gray-50">
    <div class="container">
      <div class="text-center">
        <h2 class="text-2xl font-bold text-gray-900 mb-4">Books Coming Soon</h2>
        <p class="text-gray-600">We're working on publishing amazing books for you. Check back soon!</p>
      </div>
    </div>
  </section>
)}