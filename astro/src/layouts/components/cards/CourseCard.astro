---
import { toSentenceCase } from "@/lib/utils/textConverter";
import OptimizedImage from "@/components/utilities/OptimizedImage.astro";
import {
  getLocaleUrlCTM,
  useTranslations,
} from "@/lib/utils/i18nUtils.ts";
import CustomButton from "../CustomButton.astro";
import Icons from "@/helpers/Icons.astro";
import type { CollectionEntry } from "astro:content";

interface Props {
  content: CollectionEntry<"courses">;
  class?: string;
}

const { content, class: className, ...rest } = Astro.props;
const t = await useTranslations(Astro.currentLocale as string);
const { image, icon, title, description, category, trainingDays } = content.data;

let slug = getLocaleUrlCTM(content.id, Astro.currentLocale, content.collection);
---

<div class:list={["bg-white rounded-lg overflow-hidden shadow-sm hover:shadow-lg transition-shadow duration-300 h-full flex flex-col", className]} {...rest}>
  <div class="relative">
    {
      image && (
        <OptimizedImage
          src={image}
          alt={toSentenceCase("Image about " + title)}
          width={400}
          height={200}
          class="h-48 w-full object-cover"
        />
      )
    }
    {
      icon && (
        <div class="bg-accent absolute -bottom-6 left-4 flex h-12 w-12 items-center justify-center rounded-full fill-white transition duration-300 shadow-md">
          <Icons
            icon={icon as any}
            class="h-6 w-6 stroke-1 text-white transition duration-300"
          />
        </div>
      )
    }
  </div>
  <div class="px-6 pt-10 pb-6 flex-1 flex flex-col">
    {
      category && (
        <span class="mb-2 inline-block rounded-full bg-accent/10 px-3 py-1 text-xs font-medium text-primary">
          {category}
        </span>
      )
    }
    {
      title && (
        <h3 class="text-lg font-semibold text-dark mb-3 line-clamp-2 leading-tight">
          {title}
        </h3>
      )
    }
    {description && <p class="text-text-default opacity-80 text-sm mb-4 line-clamp-3 flex-1" set:html={description} />}
    {
      trainingDays && (
        <div class="mb-4 flex items-center gap-2 text-xs text-text-default opacity-70">
          <Icons icon="Clock" class="h-3 w-3" />
          <span>{trainingDays} day{trainingDays > 1 ? 's' : ''}</span>
        </div>
      )
    }
    <div class="mt-auto">
      <CustomButton
        variant="text"
        label={t("common.readMore")}
        url={slug}
        class="text-sm"
      />
    </div>
  </div>
</div>