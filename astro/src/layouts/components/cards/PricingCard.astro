---
import type { PricingTier } from "@/types";
import CustomButton from "../CustomButton.astro";
import { markdownify, toLowerCase } from "@/lib/utils/textConverter";
import AnimatedNumber from "@/components/widgets/AnimatedNumber.astro";

type Props = {
  content: PricingTier;
  class?: string;
  pricingIndex: number;
};

const {
  class: className,
  pricingIndex,
  content: { enable, name, description, price, features, button },
  ...rest
} = Astro.props;

if (!enable) return;
---

<div
  class:list={[
    "max-lg:box-shadow-primary hover:lg:box-shadow-primary flex flex-col items-start justify-center gap-8 bg-white px-8 py-10 transition duration-500",
    pricingIndex === 1 && "box-shadow-primary",
    className,
  ]}
  {...rest}>
  <div class="flex flex-col gap-5">
    {name && <h3 class="text-h5 text-inherit" set:html={markdownify(name)} />}
    <div class="space-y-4">
      <div>
        {
          price?.map((item, index) => (
            <div
              data-plan={toLowerCase(item.type)}
              class:list={[
                "has-list has-list-slash price-wrapper flex flex-wrap items-center gap-1.5 transition-all duration-300",
                {
                  active: index === 0,
                },
                {
                  hidden: index !== 0,
                },
              ]}>
              <span class="text-h2 text-primary font-secondary after:bg-primary/50 flex gap-0 leading-none font-bold after:h-1/2!">
                <AnimatedNumber
                  animateOn="click"
                  transitionTime="1.2s"
                  content={item}
                />
              </span>
              <span
                class="text-primary pricing-type text-lg leading-none capitalize"
                set:html={item.type}
              />
            </div>
          ))
        }
      </div>
      {
        description && (
          <p
            class="text-inherit opacity-80"
            set:html={markdownify(description)}
          />
        )
      }
    </div>
    {
      features && (
        <div class="prose-styles prose-li:text-text-default/70 prose-strong:whitespace-nowrap prose-strong:bg-primary/10 prose-strong:px-2.5 prose-strong:py-1 prose-strong:text-primary prose-strong:font-medium prose-strong:text-xs prose-strong:ml-2 prose-strong:rounded-full">
          <ul class="border-primary/25 space-y-3 border-y border-dashed py-4">
            {features.map((feature) => (
              <li set:html={markdownify(feature)} />
            ))}
          </ul>
        </div>
      )
    }
  </div>
  {
    (
      <CustomButton
        {...button}
        variant={pricingIndex === 1 ? "fill" : "outline"}
      />
    )
  }
</div>
